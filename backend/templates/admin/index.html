{% extends "admin/base_site.html" %}
{% load static %}

{% block extrahead %}
  {{ block.super }}
  <link rel="stylesheet" type="text/css" href="{% static 'admin/css/custom.css' %}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .dashboard-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }
    
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    
    .dashboard-card {
      background: #fff;
      border-radius: 0.5rem;
      box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
      padding: 1.5rem;
    }
    
    .dashboard-card h3 {
      margin-top: 0;
      color: #374151;
      font-size: 1.25rem;
      font-weight: 600;
    }
    
    .stat-value {
      font-size: 2rem;
      font-weight: bold;
      color: #1f2937;
    }
    
    .stat-label {
      color: #6b7280;
      font-size: 0.875rem;
    }
    
    .chart-container {
      position: relative;
      height: 300px;
      margin: 1rem 0;
    }
    
    .recent-claims-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .recent-claims-table th,
    .recent-claims-table td {
      padding: 0.75rem;
      text-align: left;
      border-bottom: 1px solid #e5e7eb;
    }
    
    .recent-claims-table th {
      background-color: #f9fafb;
      font-weight: 600;
      color: #374151;
    }
    
    .status-badge {
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.875rem;
      font-weight: 500;
    }
    
    .status-pending {
      background-color: #fef3c7;
      color: #92400e;
    }
    
    .status-approved {
      background-color: #dcfce7;
      color: #15803d;
    }
    
    .status-rejected {
      background-color: #fee2e2;
      color: #b91c1c;
    }
  </style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
  <h1 class="text-3xl font-bold text-gray-900 mb-6">SoroSurance Dashboard</h1>
  
  <!-- Stats Cards -->
  <div class="dashboard-grid">
    <div class="dashboard-card">
      <h3>Total Claims</h3>
      <div class="stat-value">{{ total_claims|default:"0" }}</div>
      <div class="stat-label">All claims</div>
    </div>
    
    <div class="dashboard-card">
      <h3>Pending Claims</h3>
      <div class="stat-value">{{ pending_claims|default:"0" }}</div>
      <div class="stat-label">Awaiting review</div>
    </div>
    
    <div class="dashboard-card">
      <h3>Approved Claims</h3>
      <div class="stat-value">{{ approved_claims|default:"0" }}</div>
      <div class="stat-label">Successfully processed</div>
    </div>
    
    <div class="dashboard-card">
      <h3>Rejected Claims</h3>
      <div class="stat-value">{{ rejected_claims|default:"0" }}</div>
      <div class="stat-label">Denied or flagged</div>
    </div>
  </div>

  <!-- Charts Section -->
  <div class="dashboard-grid">
    <div class="dashboard-card">
      <h3>Claims by Status</h3>
      <div class="chart-container">
        <canvas id="statusChart"></canvas>
      </div>
    </div>
    
    <div class="dashboard-card">
      <h3>Claims by Type</h3>
      <div class="chart-container">
        <canvas id="typeChart"></canvas>
      </div>
    </div>
  </div>

  <!-- Recent Claims -->
  <div class="dashboard-card">
    <h3>Recent Claims</h3>
    <div class="overflow-x-auto">
      <table class="recent-claims-table">
        <thead>
          <tr>
            <th>Claim ID</th>
            <th>Type</th>
            <th>Status</th>
            <th>Date</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for claim in recent_claims %}
          <tr>
            <td>{{ claim.claim_id }}</td>
            <td>{{ claim.get_claim_type_display }}</td>
            <td>
              <span class="status-badge {% if claim.status == 'pending' %}status-pending{% elif claim.status == 'approved' %}status-approved{% else %}status-rejected{% endif %}">
                {{ claim.get_status_display }}
              </span>
            </td>
            <td>{{ claim.created_at|date:"M d, Y" }}</td>
            <td>
              <a href="{% url 'admin:claim_detail' claim.id %}" class="text-indigo-600 hover:text-indigo-900">View</a>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="5" class="text-center py-4 text-gray-500">No claims found</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
// Chart data
const statusData = {
  labels: ['Pending', 'Approved', 'Rejected'],
  datasets: [{
    data: [{{ pending_claims|default:"0" }}, {{ approved_claims|default:"0" }}, {{ rejected_claims|default:"0" }}],
    backgroundColor: ['#fef3c7', '#dcfce7', '#fee2e2'],
    borderColor: ['#f59e0b', '#10b981', '#ef4444'],
    borderWidth: 2
  }]
};

const typeData = {
  labels: [{% for label in type_labels %}"{{ label }}"{% if not forloop.last %},{% endif %}{% endfor %}],
  datasets: [{
    data: [{% for value in type_values %}{{ value }}{% if not forloop.last %},{% endif %}{% endfor %}],
    backgroundColor: ['#3b82f6', '#8b5cf6', '#06b6d4', '#f59e0b', '#ef4444'],
    borderWidth: 2
  }]
};

// Initialize charts
document.addEventListener('DOMContentLoaded', function() {
  // Status chart
  const statusCtx = document.getElementById('statusChart');
  if (statusCtx) {
    new Chart(statusCtx, {
      type: 'doughnut',
      data: statusData,
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'bottom'
          }
        }
      }
    });
  }

  // Type chart
  const typeCtx = document.getElementById('typeChart');
  if (typeCtx) {
    new Chart(typeCtx, {
      type: 'bar',
      data: typeData,
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false
          }
        },
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });
  }
});
</script>
{% endblock %}
